<link rel="import" href="./../../../../bower_components/gl-grid/gl-grid-row.html">
<link rel="import" href="./../../../../bower_components/gl-grid/gl-grid-col.html">
<link rel="import" href="./../../components/validateFormBehaviors.html">
<dom-module id="manage-group">
    <template>
        <style include="iron-flex iron-flex-factors iron-flex-alignment gl-table page-style">
            * {
                font-family: 'CSChatThaiUI', sans-serif;
                -webkit-font-smoothing: antialiased;
                font-size: var(--font-size-h5);
                text-align: left;
            }

            .text-center {
                text-align: center;
                font-size: var(--font-size-h3);
                background-color: var(--paper-grey-100);
                margin-top: 20px;
            }

            paper-dropdown-menu,
            paper-listbox,
            paper-item {
                width: 100%;
            }
        </style>
        <div class="text-center">{{title}}กลุ่ม</div>
        <template is="dom-if" if={{_checkStatus(statusAction)}}>
            <icon-button-management btn-state="[[!btnState]]"></icon-button-management>
        </template>
        <!--{{statusAction}}///[[_checkStatus(statusAction)]]-->
        <gl-grid-row width="{{getWidth}}">
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]"></gl-grid-col>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,6]]">
                <gl-form-input class="margin-top  required" required error-message="ชื่อกลุ่ม (ไทย)" label="ชื่อกลุ่ม (ไทย) :" placeholder="ชื่อกลุ่ม (ไทย)"
                    value="{{data.group_name_th}}" disabled="[[btnState]]"></gl-form-input>
            </gl-grid-col>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]"></gl-grid-col>
        </gl-grid-row>

        <gl-grid-row>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]"></gl-grid-col>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,6]]">
                <gl-form-input class="margin-top  required" required error-message="ชื่อกลุ่ม (อังกฤษ)" label="ชื่อกลุ่ม (อังกฤษ) :" placeholder="ชื่อกลุ่ม (อังกฤษ)"
                    value="{{data.group_name_en}}" disabled="[[btnState]]"></gl-form-input>
            </gl-grid-col>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]"></gl-grid-col>
        </gl-grid-row>

        <gl-grid-row>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]"></gl-grid-col>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,6]]">
                <paper-dropdown-menu label="ตาราง" placeholder="ตาราง" disabled="[[btnState]]" on-value-changed="test">
                    <paper-listbox attr-for-selected="value" selected="{{data.table}}" slot="dropdown-content" class="dropdown-content">

                        <template is="dom-repeat" items={{keydata}}>
                            <paper-item value="[[item.table]]">[[item.table]]</paper-item>
                        </template>
                    </paper-listbox>
                </paper-dropdown-menu>
            </gl-grid-col>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]"></gl-grid-col>

        </gl-grid-row>
        <gl-grid-row>
            {{getKey(data.table)}}
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]"></gl-grid-col>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,6]]">{{data.field_id}}
                <gl-combo-box id="sub-item" label="ฟิลด์รหัส" placeholder="ฟิลด์รหัส" item-label-path="id" item-value-path="id" items="{{field}}"
                    value="{{data.field_id}}">
                    <template>
                        [[item.id]]
                    </template>
                </gl-combo-box>
            </gl-grid-col>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]"></gl-grid-col>

        </gl-grid-row>

        <gl-grid-row>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]"></gl-grid-col>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,6]]">
                <nylon-tag-dropdown id="tests" label="ชื่อที่ต้องการแสดง" items="{{field}}"></nylon-tag-dropdown>
            </gl-grid-col>
            <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,3]]"></gl-grid-col>

        </gl-grid-row>

        <div class="horizontal end-justified layout">
            <div class="button">
                <paper-button raised on-tap="_cancel" hidden="{{btnState}}">คืนค่าข้อมูล</paper-button>
                <paper-button class="gl-btn-success" raised on-tap="_save" hidden="{{btnState}}">บันทึก</paper-button>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: 'manage-group',
            behaviors: [nylonBehavior, ReduxBehavior, ValidateFormBehavior],
            properties: {
                data: {
                    statePath: 'group.data',
                },
                btnState: {
                    statePath: 'commonState.btnState'
                },
                keydata: {
                    statePath: 'group.listtable',
                    // value: [
                    //     {
                    //         id: 'hamonize',
                    //         sub: [
                    //             { id: "digits" },
                    //             { id: "hamonize_code" },
                    //             { id: "hamonize_en" },
                    //             { id: "hamonize_en2" },
                    //             { id: "hamonize_th" },
                    //             { id: "hamonize_th2" },
                    //             { id: "hamonize_year" },
                    //             { id: "id" }
                    //         ]
                    //     },
                    //     {
                    //         id: 'country',
                    //         sub: [
                    //             { id: "continent_id" },
                    //             { id: "country_code2" },
                    //             { id: "country_code3" },
                    //             { id: "country_fullname_en" },
                    //             { id: "country_fullname_th" },
                    //             { id: "country_name_en" },
                    //             { id: "country_name_th" },
                    //             { id: "creater" },
                    //             { id: "date_created" },
                    //             { id: "date_updated" },
                    //             { id: "id" }
                    //         ]
                    //     },
                    // ]
                },
                field: {
                    type: Array,
                    value: []
                }
            },
            _save: function () {
                // console.log(this.data);
                // console.log(this.$$('#tests').value);
                // let name = this.$$('#tests').value.map((name)=> name.id)
                // console.log(name);
                this.data.name = this.$$('#tests').value
                // console.log(this.data);
                if (this.validateForm('.required')) {
                    if (this.statusAction == 'edit') {
                        // console.log(this.data);
                        this.dispatchAction('GROUP_EDIT', this.data);
                    }
                    else {
                        // console.log(this.data);
                        this.dispatchAction('GROUP_INSERT', this.data);
                    }
                }
            },
            _checkStatus: function (val) {
                // console.log();
                if (val != 'add') {
                    return true
                }
            },
            getKey: function (table) {
                // console.log(table);
                this.async(() => {
                    if (table !== '' && table !== undefined) {
                        let data = this.keydata.find((id) => id.table === table)
                        // console.log(data);
                        // console.log(this.keydata);
                        this.set('field', data.sub)
                        console.log(this.field);
                        this.$$('#sub-item').value = ''
                    }
                }, 2000);

            },
            _cancel: function () {
                if (this.statusAction == 'edit') {
                    this.dispatchAction('HAMONIZE_GET_ID', this.group_id);
                }
                else {
                    this.dispatchAction('CLEAR_DATA');
                }
            },
            test() {
                // console.log(1111);
            }
        });
    </script>
</dom-module>