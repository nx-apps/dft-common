<link rel="import" href="../../nylon-behavior.html">
<link rel="import" href="../../layout/page-style.html">
<link rel="import" href="./../../../bower_components/nylon-panel/nylon-panel-right.html">
<link rel="import" href="./../../../bower_components/gl-form/gl-form-panel.html">
<link rel="import" href="./../../../bower_components/gl-form/gl-form-input.html">
<link rel="import" href="./../../../bower_components/gl-styles/gl-table.html">
<link rel="import" href="./../../../bower_components/paper-input/paper-input.html">

<link rel="import" href="./../../../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="./../components/search-behavior.html">

<link rel="import" href="./../../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="./../../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="./../../../bower_components/paper-item/paper-item.html">

<link rel="import" href="./components/manage-group-item.html">
<link rel="import" href="./../components/search-behavior.html">

<link rel="import" href="./../components/icon-button-management.html">
<link rel="import" href="./../../../bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="./../../../bower_components/vaadin-grid/vaadin-grid-sorter.html">
<link rel="import" href="./../components/vaadin-gird-filter-common.html">
<dom-module id="page-group-item">
    <template>
        <style is="custom-style" include="iron-flex iron-flex-factors iron-flex-alignment gl-table page-style">
            * {
                font-family: 'CSChatThaiUI', sans-serif;
                -webkit-font-smoothing: antialiased;
                font-size: var(--font-size-h5);
            }

            .button-top {
                margin: 20px;
            }

            .text-center {
                text-align: center;
            }

            .text-head {
                text-align: center;
                padding: 10px 0px 10px 10px;
                background-color: var(--paper-grey-100);
                color: var(--paper-grey-600);
                font-size: var(--font-size-h3);
            }

            .elevation {
                border-radius: 5px;
                margin: 10px;
                padding: 5px;
                background-color: white;
            }

            .labelSearch {
                font-size: var(--font-size-h5);
                margin: 10px 10px 10px 10px;
            }

            .header-title {
                font-size: 20px;
                margin-top: 15px;
                margin-left: 25px;
            }
            vaadin-grid {
        height: auto;
      }
        </style>
        <paper-material elevation="1" class="elevation">
            <div class="header-title">
                กลุ่ม {{dataSeleted.group_name_th}}</div>
            <div class="horizontal justified layout">
                <div class="horizontal layout" style="margin-top:25px;">
                </div>
                <div>
                    <paper-button class="gl-btn-primary button-top" title="เพิ่มกลุ่ม" raised on-tap="_toggleDrawer">
                        <iron-icon icon="add"></iron-icon>เพิ่มกลุ่มย่อย</paper-button>
                </div>

            </div>

            <vaadin-grid id="material" aria-label="Basic Binding Example" items="[[data]]" multi-sort="true">

                <vaadin-grid-column width="100px" flex-grow="0" flex-grow="0" resizable>
                    <template class="header">
                        <div class="text-center">No
                            <p>(ลำดับ)</div>
                    </template>
                    <template>
                        <div class="text-center">{{_count(index)}}</div>
                    </template>
                </vaadin-grid-column>

                <vaadin-grid-column resizable>
                    <template class="header">
                        <vaadin-grid-sorter path="name_th">
                            <div class="text-center">Group
                                <p>(กลุ่ม ไทย)</div>
                        </vaadin-grid-sorter>
                        <vaadin-gird-filter-common aria-label="Group" path="name_th" value="[[_name_th]]">
                        </vaadin-gird-filter-common>
                    </template>
                    <template>
                        <div class="text-center"> [[item.name_th]]</div>
                    </template>
                </vaadin-grid-column>

                <vaadin-grid-column  resizable>
                    <template class="header">
                        <vaadin-grid-sorter path="name_en">
                            <div class="text-center">Group
                                <p>(กลุ่ม อังกฤษ)</div>
                        </vaadin-grid-sorter>
                        <vaadin-gird-filter-common aria-label="Group" path="name_en" value="[[_name_en]]">
                        </vaadin-gird-filter-common>
                    </template>
                    <template>
                        <div class="text-center"> [[item.name_en]]</div>
                    </template>
                </vaadin-grid-column>

                <!--<vaadin-grid-column width="200px" flex-grow="0" resizable>
                    <template class="header">
                        <vaadin-grid-sorter path="date_updated">
                            <div class="text-center">Date Update
                                <p>(วันที่อัพเดทล่าสุด)</div>
                        </vaadin-grid-sorter>
                    </template>
                    <template>
                        <p style="white-space: normal">{{item.date_updated}}</p>
                    </template>
                </vaadin-grid-column>-->

                <vaadin-grid-column width="150px" flex-grow="0" resizable>
                    <template class="header">
                        <div class="text-center">Tool
                            <p>(เครื่องมือ)</div>
                    </template>
                    <template>
                        <div class="text-center">
                            <span>
                                <paper-icon-button data="{{item}}" on-tap="_edit" icon="icons:create"></paper-icon-button>
                                <paper-icon-button data="{{item}}" icon="delete" on-tap="_delete"></paper-icon-button></span>
                        </div>
                    </template>
                </vaadin-grid-column>

            </vaadin-grid>
        </paper-material>
        <nylon-panel-right title="{{title}}" set-width="95%">
            <manage-group-item status-action="[[statusAction]]" title="{{title}}" name="[[dataSeleted]]"></manage-group-item>
        </nylon-panel-right>
    </template>
    <script>
        Polymer({
            is: 'page-group-item',
            behaviors: [nylonBehavior, ReduxBehavior, groupItemAction, groupAction, bankAction, buyerAction, carrierAction, continentAction,
                countryAction, hamonizeAction, incotermsAction, notifypartyAction, packageAction, portAction, shipAction, shiplineAction, surveyorAction,
                commonStateAction, SearchBehavior],
            properties: {
                data: {
                    statePath: 'groupItem.list',
                    // observer:'getData'
                },
                dataSeleted: {
                    statePath: 'commonState.data',
                    observer: 'getData'
                },
                statusAction: {
                    type: String,
                    // value: 'add'
                }
            },

            listeners: {
                'edit-input': 'editInput',
                'delete-input': '_delete'
            },
            editInput: function () {
                this.dispatchAction('BTN_SET_STATE', false);
            },
            getData(data) {
                // console.log(111111111111);
                // console.log(data);
                this.dispatchAction('GROUP_ITEM_GET_DATA', data.group_id);
                switch (data.table_name) {
                    case 'bank':
                        this.dispatchAction('BANK_GET_DATA');
                        break;
                    case 'buyer':
                        this.dispatchAction('BUYER_GET_DATA');
                        break;
                    case 'carrier':
                        this.dispatchAction('CARRIER_GET_DATA');
                        break;
                    case 'continent':
                        this.dispatchAction('CONTINENT_GET_DATA');
                        break;
                    case 'country':
                        this.dispatchAction('COUNTRY_GET_DATA');
                        break;
                    case 'hamonize':
                        this.dispatchAction('HAMONIZE_GET_DATA');
                        break;
                    case 'incoterms':
                        this.dispatchAction('INCOTERMS_GET_DATA');
                        break;
                    case 'notify_party':
                        this.dispatchAction('NOTIFY_PARTY_GET_DATA');
                        break;
                    case 'package':
                        this.dispatchAction('PACKAGE_GET_DATA');
                        break;
                    case 'port':
                        this.dispatchAction('PORT_GET_DATA');
                        break;
                    case 'ship':
                        this.dispatchAction('SHIP_GET_DATA');
                        break;
                    case 'shipline':
                        this.dispatchAction('SHIPLINE_GET_DATA');
                        break;
                    case 'surveyor':
                        this.dispatchAction('SURVEYOR_GET_DATA');
                        break;
                    default:
                        console.log('NOT FOUND');
                        this.fire('nylon-change-page', { path: `/group/กลุ่ม/17` })
                        break;
                }
            },
            nylonPageActive: function () {
                // this.dispatchAction('GROUP_GET_DATA');
                // console.log(this.dataSeleted);
                // this.dispatchAction('COUNTRY_GET_DATA');
                // this.dispatchAction('GROUP_GET_DATA');
                // console.log(this.data);
                this.dispatchAction('BTN_SET_STATE', true);
            },
            _toggleDrawer: function (e) {
                this.statusAction = 'add';
                this.dispatchAction('GROUP_ITEM_CLEAR_SELECT');
                this.$$('nylon-panel-right').open();
                this.dispatchAction('BTN_SET_STATE', false);
                this.title = "เพิ่มข้อมูล";
            },
            _back: function () {
                window.history.back();
            },
            toIndex: function (index) {
                return index + 1
            },
            _delete: function (e) {
                this.dispatchAction('GROUP_ITEM_DELETE', e.target.data.sub_group_id, this.dataSeleted);
            },
            _edit: function (e) {
                this.fire('toast', { status: 'load' })
                this.statusAction = 'edit';
                this.dispatchAction('BTN_SET_STATE', true);
                this.dispatchAction('GROUP_ITEM_GET_ID', e.target.data.sub_group_id, this.dataSeleted);
                this.title = "แก้ไขข้อมูล";
                this.async(() => {
                    this.fire('toast', {
                        status: 'success', text: 'โหลดสำเร็จ', callback: () => {
                        }
                    });
                    this.$$('nylon-panel-right').open();
                }, 1000);
            },
        });
    </script>
</dom-module>